/*
 * Copyright (c) 2019-2023, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
 *
 * NVIDIA CORPORATION and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA CORPORATION is strictly prohibited.
 */

#include <stdio.h>
#include "derate_matching_modulo.hpp"

void ref_calc_modhole(int *k_out, int E, int K, int Kd, int F, int k0, int N_cb, int Zc)
{
    int idx;
    int k=0;
    int j=0;
    while (k < E)
    {
        // avoid filler bits:
        idx = (k0+j) % N_cb;

        if ((idx < Kd) || (idx >= K))
        {
            k_out[k] = idx;
            k = k + 1;
        }
        j = j + 1;
    }
}

void fast_calc_modhole(int *k_out, int E, int K, int Kd, int F, int k0, int N_cb, int Zc, int *scenarios_out)
{

    for (int k=0; k<E; k++)
    {
        k_out[k] = derate_match_fast_calc_modulo(k, E, K, Kd, F, k0, N_cb, Zc);
    }

    return;

    int scenarios[6] = {0};
    for (int k = 0; k<E; k++)
    {
        // Assumption - we never wrap more than once...
        // Scenario 0: We start before the hole
        // Scenario 1: We start after the hole
        // Scenario 2: We start in the hole
        // Scenario 3: Unknown

        // Scenario 0: We start before the hole
        if (k0 < Kd)
        {
            if (k0 + k < Kd)
            {
                k_out[k] = (k0 + k) % N_cb;
            }
            else if ((k0 + k) < N_cb - F - 1) // after first hole before wrap
            {
                k_out[k] = ((k0 + k) % N_cb) + F+1;
            }
            else if ((k0 + k) < N_cb - F - 1 + Kd) // after first hole after wrap before second hole
            {
                k_out[k] = (((k0 + k) % N_cb) + F+1) % N_cb;
            }
            else if ((k0 + k) < 2*N_cb) // second hole
            {
                int tmp = (((k0 + k) % N_cb) + F+1) % N_cb;
                k_out[k] = tmp + F + 1;
            }
            scenarios[0]=1;
        }
        // Scenario 1: We start after the hole
        else if (k0 > K)
        {
            if ((k0 + k) < N_cb)
            {
                k_out[k] = (k0 + k) % N_cb;
            }
            else if ((k0+k - N_cb) < Kd)
            {
                k_out[k] = (k0 + k) % N_cb;
            }
            else // ((k0+k - N_cb >= Kd))
            {
                k_out[k] = ((k0 + k) % N_cb) + F+1;
            }
            scenarios[1]=1;
        }
        // Scenario 2: We start in the hole
        else if ((k0 >= Kd) && (k0 <= K))
        {
            k_out[k] = ((k0 + k) % N_cb) + F+1;
            scenarios[2]=1;
        }
        else
        {
            k_out[k] = -1;
            scenarios[3]=1;
        }
    }

    for (int k=0; k<6; k++)
    {
        if (scenarios[k] != 0)
        {
            printf("Scenario %d: %d\n",k,scenarios[k]);
            scenarios_out[k]++;
        }
    }

}

int testcases[][6] = {
    //E,K,F,k0,N_cb,Zc
    {13104, 416, 120, 417, 2600, 52}, // hand-crafted scenario 1 with multiple loops
    {13104, 416, 120, 400, 2600, 52}, // hand-crafted scenario 2 with multiple loops


    {17034, 2816, 264, 0, 17600, 352}, // TVnr_7201 c=1
    {17036, 2816, 264, 0, 17600, 352}, // TVnr_7201 c=5
    {8808, 7680, 224, 0, 25344, 384}, // TVnr_7202 c=1
    {8814, 7680, 224, 0, 25344, 384}, // TVnr_7202 c=29
    {11106, 7680, 48, 0, 25344, 384}, // TVnr_7203 c=1
    {11112, 7680, 48, 0, 25344, 384}, // TVnr_7203 c=23
    {8960, 7680, 8, 0, 25344, 384}, // TVnr_7204 c=1
    {8968, 7680, 8, 0, 25344, 384}, // TVnr_7204 c=38
    {18928, 3072, 224, 0, 19200, 384}, // TVnr_7205 c=1
    {18928, 3072, 224, 0, 19200, 384}, // TVnr_7205 c=9
    {8960, 7680, 16, 0, 25344, 384}, // TVnr_7207 c=1
    {8992, 7680, 16, 0, 25344, 384}, // TVnr_7207 c=152
    {312, 96, 48, 0, 600, 12}, // TVnr_7208 c=1
    {19656, 3072, 96, 0, 19200, 384}, // TVnr_7209 c=1
    {19656, 3072, 96, 0, 19200, 384}, // TVnr_7209 c=4
    {18018, 2816, 96, 0, 17600, 352}, // TVnr_7210 c=1
    {18018, 2816, 96, 0, 17600, 352}, // TVnr_7210 c=4
    {16380, 2560, 96, 0, 16000, 320}, // TVnr_7211 c=1
    {16380, 2560, 96, 0, 16000, 320}, // TVnr_7211 c=4
    {19656, 3072, 72, 0, 19200, 384}, // TVnr_7212 c=1
    {17034, 2816, 264, 0, 17600, 352}, // TVnr_7213 c=1
    {17036, 2816, 264, 0, 17600, 352}, // TVnr_7213 c=5
    {11388, 1792, 88, 0, 11200, 224}, // TVnr_7215 c=1
    {11388, 1792, 88, 0, 11200, 224}, // TVnr_7215 c=2
    {17034, 2816, 264, 0, 17600, 352}, // TVnr_7216 c=1
    {17036, 2816, 264, 0, 17600, 352}, // TVnr_7216 c=5
    {19656, 3072, 96, 0, 19200, 384}, // TVnr_7217 c=1
    {19656, 3072, 96, 0, 19200, 384}, // TVnr_7217 c=4
    {18018, 2816, 96, 0, 17600, 352}, // TVnr_7218 c=1
    {18018, 2816, 96, 0, 17600, 352}, // TVnr_7218 c=4
    {16380, 2560, 96, 0, 16000, 320}, // TVnr_7219 c=1
    {16380, 2560, 96, 0, 16000, 320}, // TVnr_7219 c=4
    {17034, 2816, 264, 0, 17600, 352}, // TVnr_7220 c=1
    {17036, 2816, 264, 0, 17600, 352}, // TVnr_7220 c=5
    {17034, 2816, 264, 0, 17600, 352}, // TVnr_7223 c=1
    {17036, 2816, 264, 0, 17600, 352}, // TVnr_7223 c=5
    {18928, 3072, 224, 0, 19200, 384}, // TVnr_7227 c=1
    {18928, 3072, 224, 0, 19200, 384}, // TVnr_7227 c=9
    {20040, 3072, 16, 0, 19200, 384}, // TVnr_7228 c=1
    {20048, 3072, 16, 0, 19200, 384}, // TVnr_7228 c=17
    {17034, 2816, 264, 0, 17600, 352}, // TVnr_7229 c=1
    {17036, 2816, 264, 0, 17600, 352}, // TVnr_7229 c=5
    {17034, 2816, 264, 0, 17600, 352}, // TVnr_7229 c=1
    {17036, 2816, 264, 0, 17600, 352}, // TVnr_7229 c=5
    {17034, 2816, 264, 0, 17600, 352}, // TVnr_7229 c=1
    {17036, 2816, 264, 0, 17600, 352}, // TVnr_7229 c=5
    {17034, 2816, 264, 0, 17600, 352}, // TVnr_7229 c=1
    {17036, 2816, 264, 0, 17600, 352}, // TVnr_7229 c=5
    {17034, 2816, 264, 4576, 17600, 352}, // TVnr_7230 c=1
    {17036, 2816, 264, 4576, 17600, 352}, // TVnr_7230 c=5
    {17034, 2816, 264, 8800, 17600, 352}, // TVnr_7231 c=1
    {17036, 2816, 264, 8800, 17600, 352}, // TVnr_7231 c=5
    {17034, 2816, 264, 15136, 17600, 352}, // TVnr_7232 c=1
    {17036, 2816, 264, 15136, 17600, 352}, // TVnr_7232 c=5
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7233 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7233 c=3
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7233 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7233 c=3
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7234 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7234 c=3
    {16640, 5760, 160, 0, 19008, 288}, // TVnr_7234 c=1
    {16640, 5760, 160, 0, 19008, 288}, // TVnr_7234 c=3
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7236 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7236 c=3
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7236 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7236 c=3
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7237 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7237 c=3
    {18720, 6400, 88, 0, 21120, 320}, // TVnr_7237 c=1
    {18720, 6400, 88, 0, 21120, 320}, // TVnr_7237 c=2
    {19744, 7040, 400, 0, 23232, 352}, // TVnr_7241 c=1
    {19760, 7040, 400, 0, 23232, 352}, // TVnr_7241 c=7
    {19744, 7040, 400, 0, 23232, 352}, // TVnr_7241 c=1
    {19760, 7040, 400, 0, 23232, 352}, // TVnr_7241 c=7
    {21294, 6400, 608, 5440, 21120, 320}, // TVnr_7242 c=1
    {21294, 6400, 608, 5440, 21120, 320}, // TVnr_7242 c=4
    {21294, 6400, 608, 10560, 21120, 320}, // TVnr_7243 c=1
    {21294, 6400, 608, 10560, 21120, 320}, // TVnr_7243 c=4
    {21294, 6400, 608, 17920, 21120, 320}, // TVnr_7244 c=1
    {21294, 6400, 608, 17920, 21120, 320}, // TVnr_7244 c=4
    {16848, 2816, 264, 0, 17600, 352}, // TVnr_7245 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7249 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7249 c=3
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7249 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7249 c=3
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7249 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7249 c=3
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7249 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7249 c=3
    {12480, 7680, 216, 0, 25344, 384}, // TVnr_7250 c=1
    {12480, 7680, 216, 0, 25344, 384}, // TVnr_7250 c=2
    {12480, 7680, 224, 0, 25344, 384}, // TVnr_7250 c=1
    {12480, 7680, 224, 0, 25344, 384}, // TVnr_7250 c=3
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7250 c=1
    {12480, 7680, 392, 0, 25344, 384}, // TVnr_7250 c=3
    {16640, 5760, 160, 0, 19008, 288}, // TVnr_7250 c=1
    {16640, 5760, 160, 0, 19008, 288}, // TVnr_7250 c=3
    {9024, 7680, 8, 0, 25344, 384}, // TVnr_7302 c=1
    {9048, 7680, 8, 0, 25344, 384}, // TVnr_7302 c=113
    {8960, 7680, 16, 0, 25344, 384}, // TVnr_7304 c=1
    {8992, 7680, 16, 0, 25344, 384}, // TVnr_7304 c=152
    {11088, 7680, 48, 0, 25344, 384}, // TVnr_7306 c=1
    {11112, 7680, 48, 0, 25344, 384}, // TVnr_7306 c=92
    {19656, 3072, 72, 0, 19200, 384}, // TVnr_7307 c=1
    {18018, 2816, 96, 0, 17600, 352}, // TVnr_7309 c=1
    {18018, 2816, 96, 0, 17600, 352}, // TVnr_7309 c=4
    {17472, 2816, 240, 0, 17600, 352}, // TVnr_7310 c=1
    {17472, 2816, 240, 0, 17600, 352}, // TVnr_7310 c=3
    {19656, 3072, 72, 0, 19200, 384}, // TVnr_7311 c=1
    {16380, 2560, 96, 0, 16000, 320}, // TVnr_7313 c=1
    {16380, 2560, 96, 0, 16000, 320}, // TVnr_7313 c=4
    {17472, 2816, 240, 0, 17600, 352}, // TVnr_7314 c=1
    {17472, 2816, 240, 0, 17600, 352}, // TVnr_7314 c=3
    {18928, 3072, 224, 0, 19200, 384}, // TVnr_7316 c=1
    {18928, 3072, 224, 0, 19200, 384}, // TVnr_7316 c=9
    {20040, 3072, 16, 0, 19200, 384}, // TVnr_7319 c=1
    {20048, 3072, 16, 0, 19200, 384}, // TVnr_7319 c=17
    {20040, 3072, 16, 0, 19200, 384}, // TVnr_7320 c=1
    {20048, 3072, 16, 0, 19200, 384}, // TVnr_7320 c=17
    {12736, 7680, 0, 0, 17915, 384}, // TVnr_7321 c=1
    {12768, 7680, 0, 0, 17915, 384}, // TVnr_7321 c=107
    {12736, 7680, 0, 4608, 17915, 384}, // TVnr_7323 c=1
    {12768, 7680, 0, 4608, 17915, 384}, // TVnr_7323 c=107
    {192, 64, 32, 0, 400, 8}, // TVnrPUSCH_HARQ4_7324 c=1
    {192, 64, 32, 200, 400, 8}, // TVnrPUSCH_HARQ4_7324 c=1
    {192, 64, 32, 344, 400, 8}, // TVnrPUSCH_HARQ4_7324 c=1
    {192, 64, 32, 104, 400, 8}, // TVnrPUSCH_HARQ4_7324 c=1
    {192, 64, 32, 0, 400, 8}, // TVnrPUSCH_HARQ2_7325 c=1
    {192, 64, 32, 200, 400, 8}, // TVnrPUSCH_HARQ2_7325 c=1
    {1344, 576, 200, 0, 3600, 72}, // TVnr_7901 c=1
    {1344, 576, 200, 0, 3600, 72}, // TVnr_7901 c=1
    {1344, 576, 200, 0, 3600, 72}, // TVnr_7901 c=1
    {1344, 576, 200, 0, 3600, 72}, // TVnr_7901 c=1
    {1344, 576, 200, 0, 3600, 72}, // TVnr_7901 c=1
    {1344, 576, 200, 0, 3600, 72}, // TVnr_7901 c=1
    {8704, 7680, 456, 0, 25344, 384}, // TVnr_7902 c=1
    {8704, 7680, 456, 0, 25344, 384}, // TVnr_7902 c=9
    {4032, 3520, 232, 0, 11616, 176}, // TVnr_7904 c=1
    {4032, 3520, 232, 0, 11616, 176}, // TVnr_7904 c=1
    {4032, 3520, 232, 0, 11616, 176}, // TVnr_7904 c=1
    {4032, 3520, 232, 0, 11616, 176}, // TVnr_7904 c=1
    {4032, 3520, 232, 0, 11616, 176}, // TVnr_7904 c=1
    {4032, 3520, 232, 0, 11616, 176}, // TVnr_7904 c=1
    {216, 64, 32, 0, 400, 8}, // TVnr_7018 c=1
    {192, 128, 64, 0, 800, 16}, // TVnr_7019 c=1
    {264, 256, 136, 0, 1600, 32}, // TVnr_7020 c=1
    {792, 512, 144, 0, 3200, 64}, // TVnr_7021 c=1
    {2376, 1024, 72, 0, 6400, 128}, // TVnr_7022 c=1
    {3840, 2048, 8, 0, 12800, 256}, // TVnr_7023 c=1
    {240, 96, 48, 0, 600, 12}, // TVnr_7026 c=1
    {240, 192, 104, 0, 1200, 24}, // TVnr_7027 c=1
    {792, 384, 96, 0, 2400, 48}, // TVnr_7028 c=1
    {1584, 768, 56, 0, 4800, 96}, // TVnr_7029 c=1
    {3168, 1536, 104, 0, 9600, 192}, // TVnr_7030 c=1
    {5544, 3072, 200, 0, 19200, 384}, // TVnr_7031 c=1
    {264, 80, 44, 0, 500, 10}, // TVnr_7033 c=1
    {264, 160, 88, 0, 1000, 20}, // TVnr_7034 c=1
    {528, 320, 96, 0, 2000, 40}, // TVnr_7035 c=1
    {1584, 640, 48, 0, 4000, 80}, // TVnr_7036 c=1
    {2376, 1280, 104, 0, 8000, 160}, // TVnr_7037 c=1
    {4752, 2560, 80, 0, 16000, 320}, // TVnr_7038 c=1
    {264, 112, 60, 0, 700, 14}, // TVnr_7040 c=1
    {264, 224, 112, 0, 1400, 28}, // TVnr_7041 c=1
    {792, 448, 136, 0, 2800, 56}, // TVnr_7042 c=1
    {1584, 896, 72, 0, 5600, 112}, // TVnr_7043 c=1
    {3168, 1792, 136, 0, 11200, 224}, // TVnr_7044 c=1
    {240, 144, 76, 0, 900, 18}, // TVnr_7046 c=1
    {528, 288, 88, 0, 1800, 36}, // TVnr_7047 c=1
    {1920, 1152, 136, 0, 7200, 144}, // TVnr_7049 c=1
    {4224, 2304, 72, 0, 14400, 288}, // TVnr_7050 c=1
    {264, 88, 46, 0, 550, 11}, // TVnr_7051 c=1
    {264, 176, 92, 0, 1100, 22}, // TVnr_7052 c=1
    {528, 352, 104, 0, 2200, 44}, // TVnr_7053 c=1
    {1584, 704, 56, 0, 4400, 88}, // TVnr_7054 c=1
    {2592, 1408, 8, 0, 8800, 176}, // TVnr_7055 c=1
    {4800, 2816, 264, 0, 17600, 352}, // TVnr_7056 c=1
    {240, 208, 108, 0, 1300, 26}, // TVnr_7058 c=1
    {648, 416, 120, 0, 2600, 52}, // TVnr_7059 c=1
    {1584, 832, 40, 0, 5200, 104}, // TVnr_7060 c=1
    {2880, 1664, 136, 0, 10400, 208}, // TVnr_7061 c=1
    {240, 120, 62, 0, 750, 15}, // TVnr_7062 c=1
    {384, 240, 124, 0, 1500, 30}, // TVnr_7063 c=1
    {672, 480, 128, 0, 3000, 60}, // TVnr_7064 c=1
    {1728, 960, 24, 0, 6000, 120}, // TVnr_7065 c=1
    {3456, 1920, 104, 0, 12000, 240}, // TVnr_7066 c=1
    {13104, 1280, 40, 0, 8000, 160}, // TVnr_7067 c=1
    {13104, 1664, 40, 0, 10400, 208}, // TVnr_7068 c=1
    {13104, 2048, 72, 0, 12800, 256}, // TVnr_7069 c=1
    {13104, 2816, 264, 0, 17600, 352}, // TVnr_7070 c=1
    {13104, 3840, 296, 0, 12672, 192}, // TVnr_7071 c=1
    {13104, 4480, 40, 0, 14784, 224}, // TVnr_7072 c=1
    {13104, 5760, 552, 0, 19008, 288}, // TVnr_7073 c=1
    {13104, 6400, 360, 0, 21120, 320}, // TVnr_7074 c=1
    {13104, 7040, 40, 0, 23232, 352}, // TVnr_7075 c=1
    {6552, 4160, 184, 0, 13728, 208}, // TVnr_7076 c=1
    {6552, 4160, 184, 0, 13728, 208}, // TVnr_7076 c=2
    {13104, 4160, 184, 0, 13728, 208}, // TVnr_7077 c=1
    {13104, 4160, 184, 0, 13728, 208}, // TVnr_7077 c=2
    {13104, 4480, 24, 0, 14784, 224}, // TVnr_7078 c=1
    {13104, 4480, 24, 0, 14784, 224}, // TVnr_7078 c=2
    {13104, 5120, 88, 0, 16896, 256}, // TVnr_7079 c=1
    {13104, 5120, 88, 0, 16896, 256}, // TVnr_7079 c=2
    {13104, 5760, 24, 0, 19008, 288}, // TVnr_7080 c=1
    {13104, 5760, 24, 0, 19008, 288}, // TVnr_7080 c=2
    {13104, 7040, 664, 0, 23232, 352}, // TVnr_7081 c=1
    {13104, 7040, 664, 0, 23232, 352}, // TVnr_7081 c=2
    {13104, 7680, 600, 0, 25344, 384}, // TVnr_7082 c=1
    {13104, 7680, 600, 0, 25344, 384}, // TVnr_7082 c=2
    {8736, 5760, 672, 0, 19008, 288}, // TVnr_7083 c=1
    {8736, 5760, 672, 0, 19008, 288}, // TVnr_7083 c=3
    {13104, 5760, 672, 0, 19008, 288}, // TVnr_7084 c=1
    {13104, 5760, 672, 0, 19008, 288}, // TVnr_7084 c=3
    {13104, 5760, 328, 0, 19008, 288}, // TVnr_7085 c=1
    {13104, 5760, 328, 0, 19008, 288}, // TVnr_7085 c=3
    {13104, 6400, 352, 0, 21120, 320}, // TVnr_7086 c=1
    {13104, 6400, 352, 0, 21120, 320}, // TVnr_7086 c=3
    {13104, 7040, 544, 0, 23232, 352}, // TVnr_7087 c=1
    {13104, 7040, 544, 0, 23232, 352}, // TVnr_7087 c=3
    {13104, 7680, 560, 0, 25344, 384}, // TVnr_7088 c=1
    {13104, 7680, 560, 0, 25344, 384}, // TVnr_7088 c=3
    {9828, 6400, 608, 0, 21120, 320}, // TVnr_7089 c=1
    {9828, 6400, 608, 0, 21120, 320}, // TVnr_7089 c=4
    {9828, 6400, 96, 0, 21120, 320}, // TVnr_7090 c=1
    {9828, 6400, 96, 0, 21120, 320}, // TVnr_7090 c=4
    {9828, 7040, 288, 0, 23232, 352}, // TVnr_7091 c=1
    {9828, 7040, 288, 0, 23232, 352}, // TVnr_7091 c=4
    {9828, 7680, 480, 0, 25344, 384}, // TVnr_7092 c=1
    {9828, 7680, 480, 0, 25344, 384}, // TVnr_7092 c=4
    {7860, 6400, 248, 0, 21120, 320}, // TVnr_7093 c=1
    {7866, 6400, 248, 0, 21120, 320}, // TVnr_7093 c=5
    {7860, 6400, 48, 0, 21120, 320}, // TVnr_7094 c=1
    {7866, 6400, 48, 0, 21120, 320}, // TVnr_7094 c=5
    {7860, 7040, 336, 0, 23232, 352}, // TVnr_7095 c=1
    {7866, 7040, 336, 0, 23232, 352}, // TVnr_7095 c=5
    {13104, 1280, 40, 0, 8000, 160}, // TVnr_7096 c=1
    {13104, 2048, 72, 0, 12800, 256}, // TVnr_7097 c=1
    {13104, 3840, 296, 0, 12672, 192}, // TVnr_7098 c=1
    {13104, 5760, 552, 0, 19008, 288}, // TVnr_7099 c=1
    {13104, 7040, 40, 0, 23232, 352}, // TVnr_7100 c=1
    {13104, 4480, 24, 0, 14784, 224}, // TVnr_7101 c=1
    {13104, 4480, 24, 0, 14784, 224}, // TVnr_7101 c=2
    {13104, 5120, 88, 0, 16896, 256}, // TVnr_7102 c=1
    {13104, 5120, 88, 0, 16896, 256}, // TVnr_7102 c=2
    {13104, 5760, 24, 0, 19008, 288}, // TVnr_7103 c=1
    {13104, 5760, 24, 0, 19008, 288}, // TVnr_7103 c=2
    {13104, 7040, 664, 0, 23232, 352}, // TVnr_7104 c=1
    {13104, 7040, 664, 0, 23232, 352}, // TVnr_7104 c=2
    {13104, 7680, 600, 0, 25344, 384}, // TVnr_7105 c=1
    {13104, 7680, 600, 0, 25344, 384}, // TVnr_7105 c=2
    {8736, 5760, 672, 0, 19008, 288}, // TVnr_7106 c=1
    {8736, 5760, 672, 0, 19008, 288}, // TVnr_7106 c=3
    {13104, 5760, 328, 0, 19008, 288}, // TVnr_7107 c=1
    {13104, 5760, 328, 0, 19008, 288}, // TVnr_7107 c=3
    {13104, 6400, 352, 0, 21120, 320}, // TVnr_7108 c=1
    {13104, 6400, 352, 0, 21120, 320}, // TVnr_7108 c=3
    {13104, 7040, 544, 0, 23232, 352}, // TVnr_7109 c=1
    {13104, 7040, 544, 0, 23232, 352}, // TVnr_7109 c=3
    {13104, 7680, 560, 0, 25344, 384}, // TVnr_7110 c=1
    {13104, 7680, 560, 0, 25344, 384}, // TVnr_7110 c=3
    {9828, 6400, 608, 0, 21120, 320}, // TVnr_7111 c=1
    {9828, 6400, 608, 0, 21120, 320}, // TVnr_7111 c=4
    {9828, 6400, 96, 0, 21120, 320}, // TVnr_7112 c=1
    {9828, 6400, 96, 0, 21120, 320}, // TVnr_7112 c=4
    {9828, 7040, 288, 0, 23232, 352}, // TVnr_7113 c=1
    {9828, 7040, 288, 0, 23232, 352}, // TVnr_7113 c=4
    {9828, 7680, 480, 0, 25344, 384}, // TVnr_7114 c=1
    {9828, 7680, 480, 0, 25344, 384}, // TVnr_7114 c=4
    {7860, 6400, 248, 0, 21120, 320}, // TVnr_7115 c=1
    {7866, 6400, 248, 0, 21120, 320}, // TVnr_7115 c=5
    {10480, 6400, 48, 0, 21120, 320}, // TVnr_7116 c=1
    {10488, 6400, 48, 0, 21120, 320}, // TVnr_7116 c=5
    {10480, 7040, 336, 0, 23232, 352}, // TVnr_7117 c=1
    {10488, 7040, 336, 0, 23232, 352}, // TVnr_7117 c=5
    {10480, 7680, 632, 0, 25344, 384}, // TVnr_7118 c=1
    {10488, 7680, 632, 0, 25344, 384}, // TVnr_7118 c=5
    {10480, 7680, 224, 0, 25344, 384}, // TVnr_7119 c=1
    {10488, 7680, 224, 0, 25344, 384}, // TVnr_7119 c=5
    {8736, 7040, 544, 0, 23232, 352}, // TVnr_7120 c=1
    {8736, 7040, 544, 0, 23232, 352}, // TVnr_7120 c=6
    {8736, 7040, 200, 0, 23232, 352}, // TVnr_7121 c=1
    {8736, 7040, 200, 0, 23232, 352}, // TVnr_7121 c=6
    {8736, 7680, 568, 0, 25344, 384}, // TVnr_7122 c=1
    {8736, 7680, 568, 0, 25344, 384}, // TVnr_7122 c=6
    {8736, 7680, 392, 0, 25344, 384}, // TVnr_7123 c=1
    {8736, 7680, 392, 0, 25344, 384}, // TVnr_7123 c=6
    {13104, 416, 120, 0, 2600, 52}, // TVnr_7124 c=1
    {13104, 576, 200, 0, 3600, 72}, // TVnr_7125 c=1
    {13104, 576, 64, 0, 3600, 72}, // TVnr_7126 c=1
    {13104, 704, 16, 0, 4400, 88}, // TVnr_7127 c=1
    {13104, 896, 72, 0, 5600, 112}, // TVnr_7128 c=1
    {13104, 1152, 136, 0, 7200, 144}, // TVnr_7129 c=1
    {13104, 1280, 40, 0, 8000, 160}, // TVnr_7130 c=1
    {13104, 1664, 40, 0, 10400, 208}, // TVnr_7131 c=1
    {13104, 2048, 72, 0, 12800, 256}, // TVnr_7132 c=1
    {13104, 2816, 264, 0, 17600, 352}, // TVnr_7133 c=1
    {13104, 3840, 296, 0, 12672, 192}, // TVnr_7134 c=1
    {13104, 4480, 40, 0, 14784, 224}, // TVnr_7135 c=1
    {13104, 5760, 552, 0, 19008, 288}, // TVnr_7136 c=1
    {13104, 6400, 360, 0, 21120, 320}, // TVnr_7137 c=1
    {13104, 7040, 40, 0, 23232, 352}, // TVnr_7138 c=1
    {13104, 4160, 184, 0, 13728, 208}, // TVnr_7139 c=1
    {13104, 4160, 184, 0, 13728, 208}, // TVnr_7139 c=2
    {13104, 4480, 24, 0, 14784, 224}, // TVnr_7140 c=1
    {13104, 4480, 24, 0, 14784, 224}, // TVnr_7140 c=2
    {13104, 5120, 88, 0, 16896, 256}, // TVnr_7141 c=1
    {13104, 5120, 88, 0, 16896, 256}, // TVnr_7141 c=2
    {13104, 5760, 24, 0, 19008, 288}, // TVnr_7142 c=1
    {13104, 5760, 24, 0, 19008, 288}, // TVnr_7142 c=2
    {13104, 7040, 664, 0, 23232, 352}, // TVnr_7143 c=1
    {13104, 7040, 664, 0, 23232, 352}, // TVnr_7143 c=2
    {13104, 7680, 600, 0, 25344, 384}, // TVnr_7144 c=1
    {13104, 7680, 600, 0, 25344, 384}, // TVnr_7144 c=2
    {13104, 5760, 672, 0, 19008, 288}, // TVnr_7145 c=1
    {13104, 5760, 672, 0, 19008, 288}, // TVnr_7145 c=3
    {13104, 5760, 328, 0, 19008, 288}, // TVnr_7146 c=1
    {13104, 5760, 328, 0, 19008, 288}, // TVnr_7146 c=3
    {13104, 6400, 352, 0, 21120, 320}, // TVnr_7147 c=1
    {13104, 6400, 352, 0, 21120, 320}, // TVnr_7147 c=3
    {13104, 7040, 544, 0, 23232, 352}, // TVnr_7148 c=1
    {13104, 7040, 544, 0, 23232, 352}, // TVnr_7148 c=3
    {13104, 7680, 560, 0, 25344, 384}, // TVnr_7149 c=1
    {13104, 7680, 560, 0, 25344, 384}, // TVnr_7149 c=3
    {9828, 6400, 608, 0, 21120, 320}, // TVnr_7150 c=1
    {9828, 6400, 608, 0, 21120, 320}, // TVnr_7150 c=4
    {9828, 6400, 96, 0, 21120, 320}, // TVnr_7151 c=1
    {9828, 6400, 96, 0, 21120, 320}, // TVnr_7151 c=4
    {9828, 7040, 288, 0, 23232, 352}, // TVnr_7152 c=1
    {9828, 7040, 288, 0, 23232, 352}, // TVnr_7152 c=4
    {5184, 576, 96, 0, 3600, 72}, // TVnr_7153 c=1

    {-1, 0, 0, 0, 0, 0}, // done
};

int main(void)
{
    //TB 0 ndi 0 rv = 2 Zc=8 k0=200 Kd=32 K=64 F=32 E=192 Ncb=400 Qm=2
    int scenarios[6] = {0};

    int testcase = 0;
    while (testcases[testcase][0] != -1)
    {
        int E = testcases[testcase][0];
        int K = testcases[testcase][1];
        int F = testcases[testcase][2];
        int k0 = testcases[testcase][3];
        int N_cb = testcases[testcase][4];
        int Zc = testcases[testcase][5];
        printf("Testcase %d: E=%d K=%d F=%d k0=%d N_cb=%d Zc=%d\n",testcase, E, K, F, k0, N_cb, Zc);
        int Kd = K-F;

        int ref_k_out[E];
        int k_out[E];
        int err_cnt = 0;
        ref_calc_modhole(ref_k_out, E, K, Kd, F, k0, N_cb, Zc);
        fast_calc_modhole(k_out, E, K, Kd, F, k0, N_cb, Zc, scenarios);
        for (int k=0; k<E; k++)
        {
            if (ref_k_out[k] != k_out[k])
            {
                err_cnt++;
                printf("MISMATCH %d: %d != %d\n",k,k_out[k],ref_k_out[k]);
                return -1;
            }
        }
        printf("--------------------------------------------------------------\n");
        if (err_cnt) break;
        testcase++;
    }

    for (int k=0; k<6; k++)
    {
        if (scenarios[k] != 0)
        {
            printf("Scenario %d: %d\n",k,scenarios[k]);
        }
    }

}
